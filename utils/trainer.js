var express = require('express');
var router = express.Router();


var svm = require('node-svm');
var fs = require('fs');

var dataset = [
[[18,1,0.7054462092,5002,128.4449674],0],
[[41,0,4.672177071,5015,176.1828637],2],
[[54,0,0.6468247464,7590,100.0029575],0],
[[35,0,0.6463504991,5163,331.7921992],1],
[[39,0,0.600005623,5020,229.9306098],1],
[[54,1,0.6000001687,570,114.9374717],0],
[[27,0,0.7196263921,1984,96.91940677],0],
[[52,1,2.30360857,714,220.3851765],2],
[[17,0,1.293759329,5003,166.8353461],0],
[[30,0,0.8149848564,5445,102.6929083],0],
[[52,0,0.6006353614,2772,134.8552641],0],
[[26,1,0.6008873835,5572,391.1717365],1],
[[29,1,1.009070869,5011,192.9087707],1],
[[38,1,1.63661134,14138,217.8618086],3],
[[49,0,0.600090096,6550,383.4664459],1],
[[43,1,1.768322278,3790,102.4256583],2],
[[45,1,0.8943383576,9583,156.9170568],1],
[[16,1,1.951366578,12487,19.2714602],2],
[[48,1,1.557704615,5630,118.4318728],2],
[[38,1,0.6600468198,3660,238.9653216],1],
[[31,0,0.6000051961,3099,53.40767399],0],
[[37,1,2.115586258,8680,262.1206731],3],
[[54,0,0.06845532317,6459,113.9995703],0],
[[38,0,1.359283753,6555,171.4848412],2],
[[55,0,0.625600969,7009,259.0292393],1],
[[30,0,0.6770690394,6251,103.9774903],0],
[[40,1,0.6046765435,6851,123.4748825],0],
[[16,0,1.801853443,5703,108.9781356],2],
[[27,1,0.5331442585,6060,184.1182037],1],
[[16,1,0.8300877817,3922,148.5316418],0],
[[15,0,0.7639272705,15865,106.7930895],2],
[[25,1,1.265109582,13974,39.74978725],2],
[[28,1,0.6001998868,5564,238.6762057],1],
[[27,1,0.601425982,2065,172.635934],1],
[[24,0,1.080049716,5370,294.4130695],1],
[[36,0,1.497288061,7553,26.18978724],2],
[[21,1,1.443565807,5008,56.67958402],2],
[[55,1,0.6433799117,5015,62.58901709],0],
[[30,1,0.6030365427,2549,189.3455572],1],
[[32,0,2.571303197,5808,329.948177],3],
[[39,1,2.390788331,4221,217.765304],3],
[[47,0,3.516703011,5000,341.2639575],3],
[[58,0,0.7935177509,5244,159.0367729],1],
[[43,0,0.9381195359,149,250.1162191],1],
[[29,1,1.968905026,9024,46.63059019],2],
[[19,1,1.269734543,13021,188.2126019],0],
[[53,0,0.6277742546,6926,235.3213806],1],
[[19,1,0.606678537,5377,248.7128811],1],
[[27,1,0.6011215081,6197,125.0203755],0],
[[49,1,1.217238889,8578,100.6960268],2],
[[56,0,0.6017405328,5545,75.61139343],0],
[[16,1,2.867315268,6647,158.6080668],2],
[[58,0,0.6000010487,5007,161.048558],1],
[[43,0,2.210254027,7192,68.97656137],2],
[[54,1,0.04975620881,6335,474.2973892],1],
[[24,0,1.790203691,13550,253.6585017],3],
[[17,1,0.680898574,8598,304.1734079],1],
[[18,0,4.995783669,5132,100.0000001],2],
[[41,0,1.811310108,5053,414.6461312],3],
[[43,1,1.54394228,6244,317.0520089],3],
[[53,0,1.345329561,13796,146.4689332],3],
[[44,0,0.1719517864,5794,178.475674],1],
[[22,1,1.950260818,10580,100.1019038],2],
[[54,0,1.416875925,2683,284.8456611],3],
[[34,1,0.7199966928,7489,20.45948728],0],
[[27,1,0.6210975569,5450,569.9926843],1],
[[20,1,1.790405595,5254,303.7194461],3],
[[51,0,1.68447878,5328,659.1460449],3],
[[52,1,0.6005782047,12985,242.8004029],1],
[[23,0,0.3969675048,12034,82.96881421],0],
[[19,1,1.562288181,15266,79.71764658],2],
[[31,0,3.9664183,8454,136.5785161],2],
[[58,1,0.7469605478,10613,186.1365309],1],
[[17,0,4.841599895,8911,143.1796617],2],
[[46,0,1.58842709,1141,96.38230208],2],
[[21,1,3.825002229,5170,100.281754],2],
[[42,1,1.193274025,16467,193.6194943],3],
[[39,0,0.6226939029,17264,167.2525932],1],
[[46,1,2.235742786,5680,756.0139186],3],
[[49,0,0.6714258611,4564,53.36566571],0],
[[23,0,3.560832221,8919,100.4982472],2],
[[52,0,0.7223930141,7630,66.12030633],0],
[[30,1,4.753964612,5000,122.0966416],2],
[[54,1,1.593033166,9354,100.6933814],2],
[[48,1,1.016350066,5704,278.596595],1],
[[24,0,0.9410175614,5683,103.9982981],0],
[[45,1,0.6000000181,9441,321.8488787],1],
[[55,0,2.20432919,6690,172.9501495],3],
[[29,1,1.742241925,5292,281.8511276],3],
[[36,0,0.04574236139,5050,470.4599889],1],
[[33,0,1.008276382,6795,236.4670763],1],
[[35,0,0.7223109024,11995,179.6270162],1],
[[44,1,1.639620948,1925,128.3434246],2]
];

var test = [
[24, 1, 2.2, 9000, 346.7], //3
[30, 0, 2, 5000, 46.7], //2
[35, 1, 0.8, 10000, 246.7], //1
[40, 0, 0.4, 2000, 80.3] //0
];
var clf = new svm.CSVC({
	c:1,
	kernelType: 'LINEAR',
	normalize: true,
	eps: 1e-3,
	reduce: true, // default value
    	retainedVariance: 0.95,              
    	cacheSize: 20000});
console.log("train");
clf.train(dataset, function(){
  var model = svm.getModel(); // Note: SVM#getModel requires svm to be trained
  fs.writeFileSync('./model.json', JSON.stringify(model));  // persist the model
  console.log("write done")
});

clf.train(dataset).progress(function(progress){
        console.log('training progress: %d%', Math.round(progress*100));
    }).spread(function (model, report) {
        //console.log('training report: %s\nPredictions:', so(report));
        fs.writeFileSync('./model.json', JSON.stringify(model));  // persist the model
        console.log("write done");
        console.log('done.');

	test.forEach(function(ex){
            var prediction = clf.predictSync(ex);
            console.log('result =%d', prediction);
        });
    }).done(function () {
    });
